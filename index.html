<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Привет, пользователь!</h1>
    <button id="saveButton">Сохранить данные</button>
    <button id="getButton">Получить данные</button>

    <script>
        // Получаем информацию о пользователе из Telegram Web App
        const user = Telegram.WebApp.initDataUnsafe.user;

        // Проверяем, есть ли данные о пользователе
        if (user) {
            const userId = user.id; // Используем ID пользователя в качестве уникального ключа
            const userKey = `userInfo_${userId}`; // Формируем ключ для CloudStorage

            const saveButton = document.getElementById('saveButton');
            const getButton = document.getElementById('getButton');

            saveButton.addEventListener('click', () => {
                const userData = { username: user.first_name, score: 100 }; // Пример данных для сохранения
                CloudStorage.setValue(userKey, JSON.stringify(userData))
                    .then(() => {
                        HapticFeedback.notificationOccurred('success');
                        alert('Данные успешно сохранены!');
                    })
                    .catch((error) => {
                        console.error('Ошибка при сохранении данных:', error);
                    });
            });

            getButton.addEventListener('click', () => {
                CloudStorage.getValue(userKey)
                    .then((value) => {
                        if (value) {
                            const userInfo = JSON.parse(value);
                            alert(`Данные пользователя: ${userInfo.username}, Очки: ${userInfo.score}`);
                        } else {
                            alert('Данные не найдены.');
                        }
                    })
                    .catch((error) => {
                        console.error('Ошибка при извлечении данных:', error);
                    });
            });
        } else {
            alert('Не удалось получить данные о пользователе.');
        }
    </script>
</body>
</html>
