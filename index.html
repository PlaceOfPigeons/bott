<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Привет, <span id="username"></span>!</h1>
    <p>Ваши очки: <span id="points">0</span></p>
    <button id="addPoints">Добавить 25 очков</button>

    <script>
        // Инициализация Telegram Web App
        const webApp = window.Telegram.WebApp;

        // Получение имени пользователя из initData
        const user = JSON.parse(decodeURIComponent(webApp.initData));
        document.getElementById('username').textContent = user.user.first_name || "Гость";

        // Функция для загрузки очков из Cloud Storage
        function loadPoints() {
            webApp.CloudStorage.getItem('user_points', (error, value) => {
                if (error) {
                    console.error('Ошибка при получении очков:', error);
                } else {
                    // Если значение не существует, устанавливаем 0
                    document.getElementById('points').textContent = value ? value : 0;
                }
            });
        }

        // Функция для сохранения очков в Cloud Storage
        function savePoints(newPoints) {
            webApp.CloudStorage.setItem('user_points', newPoints, (error) => {
                if (error) {
                    console.error('Ошибка при сохранении очков:', error);
                } else {
                    console.log('Очки успешно сохранены');
                }
            });
        }

        // Обработчик события нажатия на кнопку
        document.getElementById('addPoints').addEventListener('click', () => {
            let currentPoints = parseInt(document.getElementById('points').textContent);
            currentPoints += 25; // Добавляем 25 очков
            document.getElementById('points').textContent = currentPoints; // Обновляем отображаемые очки
            savePoints(currentPoints); // Сохраняем новые очки
        });

        // Загружаем очки при загрузке страницы
        loadPoints();
    </script>
</body>
</html>
