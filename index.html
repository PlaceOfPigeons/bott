<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Catcher</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000; /* Черный фон */
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #game {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000; /* Абсолютно черный фон */
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 28px;
            color: #fff; /* Белый текст */
            font-weight: bold;
        }

        #sequence {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            color: #fff; /* Белый текст */
            font-weight: bold;
        }

        .emoji {
            position: absolute;
            width: 96px; /* Увеличенная ширина изображения */
            height: 96px; /* Увеличенная высота изображения */
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease;
            user-select: none; /* Запрещаем выделение текста */
        }

        .emoji.falling {
            animation: fall linear 4s forwards;
        }

        .emoji.clicked {
            transform: scale(1.5) rotate(10deg);
            opacity: 0;
        }

        .points {
            position: absolute;
            font-size: 24px;
            color: #00ff00;
            font-weight: bold;
            opacity: 1;
            transition: opacity 1s ease;
            pointer-events: none; /* Убираем возможность взаимодействия */
        }

        .points.plus10 {
            color: #ff0000; /* Красный для +10 очков */
            font-size: 36px;
        }

        @keyframes fall {
            0% {
                top: -50px;
                transform: rotate(0deg);
            }
            100% {
                top: 100vh;
                transform: rotate(360deg);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
    </style>
</head>
<body>
    <div id="game">
        <div id="score">Очки: 0</div>
        <div id="sequence"></div>
    </div>

    <script>
        const game = document.getElementById('game');
        const scoreDisplay = document.getElementById('score');
        const sequenceDisplay = document.getElementById('sequence');
        const emojis = ['image1.jpeg', 'image2.jpeg', 'image3.jpeg'];
        let score = 0;
        let currentSequence = [];
        let userSequence = [];
        let lastClickX = 0;
        let lastClickY = 0;
        const emojiWidth = 96; // Обновляем ширину для новых размеров изображений
        const screenWidth = window.innerWidth;
        const maxLeft = screenWidth - emojiWidth;

        function vibrate() {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            } else if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.HapticFeedback.impactOccurred('light');
            }
        }

        function createSequence() {
            currentSequence = [];
            for (let i = 0; i < 3; i++) {
                currentSequence.push(emojis[Math.floor(Math.random() * emojis.length)]);
            }
            sequenceDisplay.innerHTML = currentSequence.map(img => `<img src="${img}" style="width: 72px; height: 72px;">`).join(' ');
        }

        function createEmoji() {
            const emoji = document.createElement('img');
            emoji.classList.add('emoji', 'falling');
            emoji.src = emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.left = `${Math.random() * maxLeft}px`;

            game.appendChild(emoji);

            let isClicked = false;

            emoji.addEventListener('click', (event) => {
                if (isClicked) return; // Если уже кликнули, игнорируем последующие клики
                isClicked = true;

                vibrate();
                userSequence.push(emoji.src);
                score++;
                updateScoreDisplay(score);

                lastClickX = event.clientX;
                lastClickY = event.clientY;

                // Создаем элемент анимации для клика
                const pointAnim = document.createElement('div');
                pointAnim.classList.add('points');
                pointAnim.textContent = "+1";
                pointAnim.style.left = `${lastClickX}px`;
                pointAnim.style.top = `${lastClickY}px`;
                game.appendChild(pointAnim);

                setTimeout(() => pointAnim.remove(), 1000); // Убираем после анимации

                emoji.classList.add('clicked');
                setTimeout(() => emoji.remove(), 300); // Убираем после анимации
                checkSequence();
            });

            emoji.addEventListener('animationend', () => {
                emoji.remove();
            });
        }

        function updateScoreDisplay(newScore) {
            scoreDisplay.textContent = `Очки: ${newScore}`;
        }

        function checkSequence() {
            for (let i = 0; i < userSequence.length; i++) {
                if (userSequence[i] !== currentSequence[i]) {
                    userSequence = []; // Сбрасываем прогресс, если порядок неправильный
                    return;
                }
            }

            if (userSequence.length === currentSequence.length) {
                score += 10;  // Добавляем 10 очков за правильную последовательность

                // Создаем элемент анимации для правильной последовательности
                const pointAnim = document.createElement('div');
                pointAnim.classList.add('points', 'plus10');
                pointAnim.textContent = "+10";
                pointAnim.style.left = `${lastClickX}px`;
                pointAnim.style.top = `${lastClickY}px`;
                game.appendChild(pointAnim);

                setTimeout(() => pointAnim.remove(), 1000); // Убираем после анимации

                updateScoreDisplay(score);
                userSequence = [];
                createSequence();
            }
        }

        function startGame() {
            setInterval(createEmoji, 1000);
            createSequence();
        }

        startGame();
    </script>
</body>
</html>
